# AWS Setup Guide for PX4 SITL on EC2 from GitHub Actions

This guide explains how to configure AWS resources to run PX4 SITL simulations using EC2, ECR, and S3 â€” controlled from GitHub Actions.

> **ðŸ’¡ Tip:** Follow [ec2-github-runner](https://github.com/machulav/ec2-github-runner) repository.

---

## VPC Setup

Create a VPC:

- Name: `px4-vpc`
- IPv4 CIDR block: `10.0.0.0/16`

---

## Subnet Setup

Create a subnet:

- Name: `px4-subnet`
- VPC: `px4-vpc`
- IPv4 CIDR block: `10.0.1.0/24`
- Enable auto-assign public IPv4 address

---

## Internet Gateway Setup

Create an Internet Gateway:

- Name: `px4-internet-gateway`
- Attach to: `px4-vpc`

---

## Route Table Setup

Create a Route Table:

- Name: `px4-route-table`
- VPC: `px4-vpc`

Add Route:

- Destination: `0.0.0.0/0`
- Target: `px4-internet-gateway`

Associate the Route Table with `px4-subnet`.

---

## Security Group Setup

Create a Security Group:

- Name: `px4-security-group`
- VPC: `px4-vpc`

Inbound Rules:

- SSH (Port 22) â†’ From your IP or `0.0.0.0/0`
- HTTPS (Port 443) â†’ From `0.0.0.0/0`

Outbound Rules:

- Allow all traffic (`0.0.0.0/0`)

---

## IAM Role for EC2 Instance

Create an IAM Role:

- Name: `px4_sitl_on_aws`
- Trusted Entity: EC2

Attach Policies:

- `AmazonEC2FullAccess`
- `AmazonECRFullAccess`
- `AmazonS3FullAccess`
- `AmazonSSMManagedInstanceCore`

---

## IAM Policy for GitHub Actions User

To allow GitHub Actions to start EC2 with a role:

Attach the following inline policy to the IAM user running the workflow:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "iam:PassRole",
      "Resource": "arn:aws:iam::<your-account-id>:role/px4_sitl_on_aws"
    }
  ]
}
```

## EC2 AMI

Use the latest official Ubuntu 24.04 LTS AMI.

Example AMI ID for `eu-west-1` (Ireland region):

`ami-0221cb43bdc5b320b`

Check for the latest AMI here: https://cloud-images.ubuntu.com/locator/

---

## ECR Setup

Create an ECR repository for the simulation Docker image:

- Repository Name: `px4_sitl_on_aws`

Your full image URI for push/pull:

`<your-account-id>.dkr.ecr.eu-west-1.amazonaws.com/px4_sitl_on_aws:latest`

Make sure your GitHub workflow authenticates to ECR using:

`aws-actions/amazon-ecr-login@v1`

---

## S3 Bucket Setup

Create an S3 Bucket to store ROS 2 bag files generated by the simulation:

- Bucket Name: `px4-sitl-on-aws-bags`
- Region: `eu-west-1`
- Block all public access (default)

The EC2 instance running the simulation will upload files to this bucket at the end of the run.

---

## Final AWS Resource Summary

| Resource           | Name                          |
|-------------------|--------------------------------|
| VPC               | px4-vpc                       |
| Subnet            | px4-subnet                    |
| Internet Gateway  | px4-internet-gateway          |
| Route Table       | px4-route-table               |
| Security Group    | px4-security-group            |
| IAM Role          | px4_sitl_on_aws               |
| EC2 Instance Type | c6i.2xlarge                   |
| EC2 AMI           | Ubuntu 24.04 LTS              |
| ECR Repo          | px4_sitl_on_aws               |
| S3 Bucket         | px4-sitl-on-aws-bags          |

---
